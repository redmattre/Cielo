<!doctype html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="navbar.css">
    <link rel="stylesheet" href="stepSlider.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cielo</title>
  </head>
  <body>

    <div class="bottonieraSotto" id="bottonieraSotto">
      <div class="visualizzazione" id="visualizzazione">
        Prospettiva
      </div>
    </div>

    <div class="dockTasti">
      <button title="chiudi trasformazione" id="toggleTransButton" class="topButtons" style="display: none;">⏚</button>
      <button title="aggiungi elemento 3D" id="addElementMenu">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4 12H20M12 4V20" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button id="addCloudElement" style="display: none;">☁</button>
      <button title="toggle cursore POV" id="addPovCursor">
        <svg fill="currentColor" viewBox="-7 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">
          <path d="M13.88 24.16c-0.48 0-0.84-0.36-0.84-0.84v-4.76c0-0.48 0.36-0.84 0.84-0.84s0.84 0.36 0.84 0.84v4.76c0 0.48-0.36 0.84-0.84 0.84zM3.84 24.16c-0.48 0-0.84-0.36-0.84-0.84v-4.76c0-0.48 0.36-0.84 0.84-0.84s0.84 0.36 0.84 0.84v4.76c-0.040 0.48-0.44 0.84-0.84 0.84zM16.76 21.8c-0.040 0-0.080 0-0.12 0-0.44-0.080-0.76-0.48-0.72-0.96 0-0.040 0.84-6-1.92-9.24-1.2-1.36-2.92-2.080-5.12-2.080s-3.92 0.68-5.12 2.080c-2.8 3.24-1.92 9.16-1.92 9.24 0.080 0.44-0.24 0.88-0.72 0.96-0.44 0.080-0.88-0.24-0.96-0.72-0.080-0.28-0.96-6.76 2.28-10.6 1.52-1.76 3.68-2.68 6.4-2.68s4.88 0.88 6.4 2.68c3.28 3.8 2.36 10.32 2.32 10.56-0.040 0.44-0.4 0.76-0.8 0.76z"></path>
        </svg>
      </button>
      
      <!-- Il bottone metro verrà inserito qui dinamicamente -->
      
      <button title="menu di oggetti nella scena" id="seeItemsList">
        <svg viewBox="0 0 600 600" xmlns="http://www.w3.org/2000/svg">
          <g transform="matrix(0.95173205,0,0,0.95115787,13.901174,12.168794)" style="stroke-width:1.05103">
            <path style="color:#000000;fill:currentColor;stroke-linecap:round;-inkscape-stroke:none" d="M 447.70881 -12.781343 A 42.041451 42.041451 0 0 0 405.66786 29.260344 L 405.66786 50.301721 L 27.434765 50.301721 A 42.041302 42.041302 0 0 0 -14.606185 92.341354 A 42.041302 42.041302 0 0 0 27.434765 134.38304 L 405.66786 134.38304 L 405.66786 155.44906 A 42.041451 42.041451 0 0 0 447.70881 197.49075 A 42.041451 42.041451 0 0 0 489.74976 155.44906 L 489.74976 134.38304 L 573.78036 134.38304 A 42.041302 42.041302 0 0 0 615.82336 92.341354 A 42.041302 42.041302 0 0 0 573.78036 50.301721 L 489.74976 50.301721 L 489.74976 29.260344 A 42.041451 42.041451 0 0 0 447.70881 -12.781343 z M 143.0012 197.48869 A 42.041451 42.041451 0 0 0 100.9582 239.53038 L 100.9582 260.5697 L 27.447078 260.5697 A 42.041302 42.041302 0 0 0 -14.593872 302.61139 A 42.041302 42.041302 0 0 0 27.447078 344.65308 L 100.9582 344.65308 L 100.9582 365.7191 A 42.041451 42.041451 0 0 0 143.0012 407.76078 A 42.041451 42.041451 0 0 0 185.04215 365.7191 L 185.04215 344.65308 L 573.79472 344.65308 A 42.041302 42.041302 0 0 0 615.83567 302.61139 A 42.041302 42.041302 0 0 0 573.79472 260.5697 L 185.04215 260.5697 L 185.04215 239.53038 A 42.041451 42.041451 0 0 0 143.0012 197.48869 z M 279.59427 407.76078 A 42.041451 42.041451 0 0 0 237.55332 449.80042 L 237.55332 470.83974 L 27.447078 470.83974 A 42.041302 42.041302 0 0 0 -14.593872 512.88143 A 42.041302 42.041302 0 0 0 27.447078 554.92106 L 237.55332 554.92106 L 237.55332 575.98913 A 42.041451 42.041451 0 0 0 279.59427 618.02877 A 42.041451 42.041451 0 0 0 321.63522 575.98913 L 321.63522 554.92106 L 573.79472 554.92106 A 42.041302 42.041302 0 0 0 615.83567 512.88143 A 42.041302 42.041302 0 0 0 573.79472 470.83974 L 321.63522 470.83974 L 321.63522 449.80042 A 42.041451 42.041451 0 0 0 279.59427 407.76078 z " />
          </g>
        </svg>
      </button>
      
      <!-- Bottoni originali nascosti ma mantenuti per backward compatibility -->
      <div style="display: none;">
        <button id="addHalo">❍</button>
        <button id="addCone">⊚</button>
        <button id="addZone">⛶</button>
        <button id="addArrow">➞</button>
        <button id="addSphere">⬤</button>
      </div>
    </div>
    
    <div id="black-panel">
      <div id="new-panel-tabs-container">
        <!-- Tab system will be inserted here -->
      </div>
      <div class="container">
        <div class="panel-section panel-content" data-panel-content="generali" style="display:block;">
          <!-- New system will replace this content -->
          <div id="new-panel-generali-container"></div>
          
          <!-- Keep original elements hidden for backward compatibility -->
          <div style="display: none;">
            <div class="switch-wrapper">
              <label class="switch">
                <input type="checkbox" data-id="theme"/>
                <div></div>
              </label>
              <span class="switch-label">Tema Eco</span>
            </div>
            <div class="switch-wrapper">
              <label class="switch">
                <input type="checkbox" data-id="gridSnapState" checked/>
                <div></div>
              </label>
              <span class="switch-label">Aggancio Griglia</span>
            </div>
            <div class="input-wrapper">
              <label class="multitoggle">
                <input type='range' min='1' max='3' value='2' step='1' class="n n3" data-id="snapDefinition"/>
              </label>
            </div>
            <div class="switch-wrapper">
              <label class="switch">
                <input type="checkbox" data-id="lock"/>
                <div></div>
              </label>
              <span class="switch-label">Diorama</span>
            </div>
            <div class="switch-wrapper">
              <label class="switch">
                <input type="checkbox" data-id="grid" checked/>
                <div></div>
              </label>
              <span class="switch-label">Super Superficie</span>
            </div>
            <div class="input-wrapper">
              <label class="multitoggle">
                <input type='range' min='1' max='4' value='2' step='1' class="n n4" data-id="gridsize"/>
              </label>
            </div>
            <!-- Multi-Client Sync Toggle -->
            <div class="switch-wrapper">
              <label class="switch">
                <input type="checkbox" data-id="multiClient"/>
                <div></div>
              </label>
              <span class="switch-label">Sincronizzazione Multi-Client</span>
            </div>
            <div id="multiClientStatus" style="font-size: 0.8em; color: #888; margin: 5px 0; display: none;">
              Status: Disconnesso
            </div>
            <!-- Bottoni progetto -->
            <div class="input-wrapper">
              <button id="saveProjectBtn" class="menuButton">Save Project</button>
            </div>
            <div class="input-wrapper">
              <button id="saveProjectAsBtn" class="menuButton">Save Project As</button>
            </div>
            <div class="input-wrapper">
              <button id="loadProjectBtn" class="menuButton">Load Project</button>
            </div>
            
            <!-- Bottoni import preset -->
            <div class="input-wrapper">
              <button id="loadSpeakersPresetBtn" class="menuButton">Load Speakers</button>
            </div>
            <div class="input-wrapper">
              <button id="saveSpeakersPresetBtn" class="menuButton">Save Speakers</button>
            </div>
            <div class="input-wrapper">
              <button id="loadSourcesPresetBtn" class="menuButton">Load Sources</button>
            </div>
            <div class="input-wrapper">
              <button id="saveSourcesPresetBtn" class="menuButton">Save Sources</button>
            </div>
            <div class="input-wrapper">
              <button id="resetSceneBtn" class="menuButton">Empty</button>
            </div>
          </div>
        </div>

        <div class="panel-section panel-content" data-panel-content="plastico" style="display:none;">
          <!-- New system will replace this content -->
          <div id="new-panel-plastico-container"></div>
          
          <!-- Keep original elements hidden for backward compatibility -->
          <div style="display: none;">
            <div class="panel-title">Plastico</div>
            <button class="menuButton" id="loadPlastico">Carica</button>
            <div class="switch-wrapper">
              <label class="switch">
                <input type="checkbox" data-id="archVisibility" checked/>
                <div></div>
              </label>
              <span class="switch-label">⏿</span>
            </div>
            <label class="multitoggle">
              <span class="slider-label">Threshold</span>
              <div class="input-wrapper">
                <input type='range' min='0' max='120' value='60' step='1' class="n n4" id="plasticoThreshold"/>
              </div>
            </label>
            <label class="multitoggle">
              <span class="slider-label">Line Thickness</span>
              <div class="input-wrapper">
                <input type='range' min='0.5' max='10' value='2' step='0.1' class="n n4" id="plasticoThickness"/>
              </div>
            </label>
            <label class="multitoggle">
              <span class="slider-label">Opacity</span>
              <div class="input-wrapper">
                <input type='range' min='0.1' max='1.0' value='0.8' step='0.01' class="n n4" id="plasticoOpacity"/>
              </div>
            </label>
          </div>
        </div>

        <div class="panel-section panel-content" data-panel-content="carica" style="display:none;">
          <div id="new-panel-carica-container"></div>
          <div style="display: none;">
            <div class="panel-title">Carica Modello</div>
            <button class="button menuButton" id="loadGenericGltf">Carica</button>
          </div>
        </div>

        <div class="panel-section panel-content" data-panel-content="zone" style="display:none;">
          <div id="new-panel-zone-container"></div>
          <div style="display: none;">
            <div class="panel-title">Zone</div>
            <div class="switch-wrapper">
              <label class="switch">
                <input type="checkbox" data-id="zoneVisibility" checked/>
                <div></div>
              </label>
              <span class="switch-label">⏿</span>
            </div>
          </div>
        </div>

        <div class="panel-section panel-content" data-panel-content="altoparlanti" style="display:none;">
          <div id="new-panel-altoparlanti-container"></div>
          <div style="display: none;">
            <div class="panel-title">Altoparlanti</div>
            <div class="switch-wrapper">
              <label class="switch">
                <input type="checkbox" data-id="speakersVisibility" checked/>
                <div></div>
              </label>
              <span class="switch-label">⏿</span>
            </div>
          </div>
        </div>

        <div class="panel-section panel-content" data-panel-content="corone" style="display:none;">
          <div id="new-panel-corone-container"></div>
          <div style="display: none;">
            <div class="panel-title">Corone</div>
            <div class="switch-wrapper">
              <label class="switch">
                <input type="checkbox" data-id="speakersVisibility" checked/>
                <div></div>
              </label>
              <span class="switch-label">⏿</span>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div id="infoDivTopLeft">---</div>
    
    <!-- Save icon in alto a destra -->
    <button id="quickSaveBtn" class="quick-save-btn" title="Save Project (Cmd+S)">
      <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <path d="M171,525 C171.552,525 172,524.553 172,524 L172,520 C172,519.447 171.552,519 171,519 C170.448,519 170,519.447 170,520 L170,524 C170,524.553 170.448,525 171,525 L171,525 Z M182,543 C182,544.104 181.104,545 180,545 L156,545 C154.896,545 154,544.104 154,543 L154,519 C154,517.896 154.896,517 156,517 L158,517 L158,527 C158,528.104 158.896,529 160,529 L176,529 C177.104,529 178,528.104 178,527 L178,517 L180,517 C181.104,517 182,517.896 182,519 L182,543 L182,543 Z M160,517 L176,517 L176,526 C176,526.553 175.552,527 175,527 L161,527 C160.448,527 160,526.553 160,526 L160,517 L160,517 Z M180,515 L156,515 C153.791,515 152,516.791 152,519 L152,543 C152,545.209 153.791,547 156,547 L180,547 C182.209,547 184,545.209 184,543 L184,519 C184,516.791 182.209,515 180,515 L180,515 Z" transform="translate(-152 -515)" fill="currentColor"/>
      </svg>
    </button>

    <!-- Menu centrale per selezione elementi 3D -->
    <div id="addElementCenterMenu">
      <div class="add-menu-grid">
        <button class="add-menu-item" data-element="sphere">
          <span class="add-menu-icon">⬤</span>
          <span class="add-menu-label">Omnifonte</span>
        </button>
        <button class="add-menu-item" data-element="cone">
          <span class="add-menu-icon">⊚</span>
          <span class="add-menu-label">Altoparlante</span>
        </button>
        <button class="add-menu-item" data-element="arrow">
          <span class="add-menu-icon">➞</span>
          <span class="add-menu-label">Orifonte</span>
        </button>
        <button class="add-menu-item" data-element="halo">
          <span class="add-menu-icon">❍</span>
          <span class="add-menu-label">Aureola</span>
        </button>
        <button class="add-menu-item" data-element="zone">
          <span class="add-menu-icon">⛶</span>
          <span class="add-menu-label">Zona</span>
        </button>
        <button class="add-menu-item" data-element="plastico">
          <span class="add-menu-icon">⌘</span>
          <span class="add-menu-label">Plastico</span>
        </button>
      </div>
      
      <!-- Barra di configurazione in basso -->
      <div id="addMenuConfigBar" class="add-menu-config-bar">
        <div class="config-section">
          <label>Quantità:</label>
          <input type="number" id="elementQuantity" min="1" value="1" class="config-input">
        </div>
        
        <div class="config-section" id="arrangementSection">
          <label>Disposizione:</label>
          <select id="arrangementType" class="config-select">
            <option value="square">Quadrato</option>
            <option value="circle">Cerchio</option>
            <option value="line">Linea</option>
          </select>
        </div>
        
        <div class="config-section" id="configContextual">
          <!-- Contenuto dinamico basato sulla disposizione -->
          <div id="squareConfig">
            <div class="config-section">
              <label>Lato X (m):</label>
              <input type="number" id="squareSideX" step="0.1" value="4" class="config-input-small">
            </div>
            <div class="config-section">
              <label>Lato Z (m):</label>
              <input type="number" id="squareSideZ" step="0.1" value="4" class="config-input-small">
            </div>
          </div>
          
          <div id="circleConfig" style="display: none;">
            <div class="config-section">
              <label>Raggio (m):</label>
              <input type="number" id="circleRadius" step="0.1" value="2" class="config-input-small">
            </div>
            <div class="config-section">
              <label>Gradi:</label>
              <input type="number" id="circleAngle" min="1" max="360" value="360" class="config-input-small">
            </div>
          </div>
          
          <div id="lineConfig" style="display: none;">
            <div class="config-section">
              <label>Orientamento:</label>
              <select id="lineOrientation" class="config-select">
                <option value="horizontal">Orizzontale (X)</option>
                <option value="vertical">Verticale (Y)</option>
                <option value="perpendicular">Perpendicolare (Z)</option>
              </select>
            </div>
            <div class="config-section">
              <label>Lunghezza (m):</label>
              <input type="number" id="lineLength" step="0.1" value="4" class="config-input-small">
            </div>
          </div>
        </div>
        
        <button id="addElementExecute" class="config-add-button" disabled>Aggiungi</button>
      </div>
      
      <button id="closeAddElementMenu" class="add-menu-close">✕</button>
    </div>

    <div id="menuList"></div>

    <!-- Bottone settings per aprire il menu laterale -->
    <button id="openSideMenu" title="Settings">
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M11 3H13C13.5523 3 14 3.44772 14 4V4.56879C14 4.99659 14.2871 5.36825 14.6822 5.53228C15.0775 5.69638 15.5377 5.63384 15.8403 5.33123L16.2426 4.92891C16.6331 4.53838 17.2663 4.53838 17.6568 4.92891L19.071 6.34312C19.4616 6.73365 19.4615 7.36681 19.071 7.75734L18.6688 8.1596C18.3661 8.46223 18.3036 8.92247 18.4677 9.31774C18.6317 9.71287 19.0034 10 19.4313 10L20 10C20.5523 10 21 10.4477 21 11V13C21 13.5523 20.5523 14 20 14H19.4312C19.0034 14 18.6318 14.2871 18.4677 14.6822C18.3036 15.0775 18.3661 15.5377 18.6688 15.8403L19.071 16.2426C19.4616 16.6331 19.4616 17.2663 19.071 17.6568L17.6568 19.071C17.2663 19.4616 16.6331 19.4616 16.2426 19.071L15.8403 18.6688C15.5377 18.3661 15.0775 18.3036 14.6822 18.4677C14.2871 18.6318 14 19.0034 14 19.4312V20C14 20.5523 13.5523 21 13 21H11C10.4477 21 10 20.5523 10 20V19.4313C10 19.0034 9.71287 18.6317 9.31774 18.4677C8.92247 18.3036 8.46223 18.3661 8.1596 18.6688L7.75732 19.071C7.36679 19.4616 6.73363 19.4616 6.34311 19.071L4.92889 17.6568C4.53837 17.2663 4.53837 16.6331 4.92889 16.2426L5.33123 15.8403C5.63384 15.5377 5.69638 15.0775 5.53228 14.6822C5.36825 14.2871 4.99659 14 4.56879 14H4C3.44772 14 3 13.5523 3 13V11C3 10.4477 3.44772 10 4 10L4.56877 10C4.99658 10 5.36825 9.71288 5.53229 9.31776C5.6964 8.9225 5.63386 8.46229 5.33123 8.15966L4.92891 7.75734C4.53838 7.36681 4.53838 6.73365 4.92891 6.34313L6.34312 4.92891C6.73365 4.53839 7.36681 4.53839 7.75734 4.92891L8.15966 5.33123C8.46228 5.63386 8.9225 5.6964 9.31776 5.53229C9.71288 5.36825 10 4.99658 10 4.56876V4C10 3.44772 10.4477 3 11 3Z" stroke="currentColor" stroke-width="1.248"/>
        <path d="M14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12Z" stroke="currentColor" stroke-width="1.248"/>
      </svg>
    </button>

    <div id="selection-rectangle" style="position:fixed; pointer-events:none; border:1.5px dashed #4488ff; background:rgba(68,136,255,0.08); display:none; z-index:1000;"></div>

    <div id="scene-mask"></div>
    <div id="scene-mask-blur"></div>

    <script type="module" src="main.js"></script>
    <script type="module" src="setup.js"></script>
    <script type="module" src="materials.js"></script>
    <script type="module" src="loaders.js"></script>
    <script type="module" src="loadersFIX.js"></script>
    <script type="module" src="raycaster.js"></script>
    <script type="module" src="UI.js"></script>
    <script type="module" src="addgeometries.js"></script>
    <script type="module" src="objmenu_new.js"></script>
    <script type="module" src="rightmenu.js"></script>
    <script type="module" src="addElementMenu.js"></script>
    <script type="module" src="navbar.js"></script>
    <script type="module" src="max.js"></script>
    <script>
      // Old tab system - now handled by rightmenu.js
      // Keeping this as fallback but it's now managed by the new system
    </script>
  </body>
</html>
</html>
